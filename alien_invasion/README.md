# Alien Invasion

This is a Python game project for the Pygame Zero library.

## 规划项目
在游戏《外星人入侵》中，玩家控制一艘最初出现在屏幕底部中央的飞船。玩家可以使用箭头键左右移动飞船，还可使用空格键射击。游戏开始时，一群外星人出现在天空中，并向屏幕下方移动。玩家的任务是射杀这些外星人。玩家将所有外星人都消灭干净后，将出现一群新的外星人，其移动速度更快。只要有外星人撞到玩家的飞船或到达屏幕底部，玩家就损失一艘飞船。玩家损失三艘飞船后，游戏结束。


## 武装飞船
### 安装Pygame
开始编码前，先来安装Pygame。可使用pip模块来帮助下载并安装Python包。要安装Pygame，在终端提示符下执行如下命令：
```
$ python3 -m pip install --user pygame
```
### 开始游戏项目
开始开发游戏《外星人入侵》吧。首先要创建一个空的Pygame窗口，供之后用来绘制游戏元素，如飞船和外星人。我们还将让这个游戏响应用户输入，设置背景色，以及加载飞船图像。

#### 创建Pygame窗口及响应用户输入
下面创建一个表示游戏的类，以创建空的Pygame窗口。

首先，导入模块sys和pygame。模块pygame包含开发游戏所需的功能。玩家退出时，我们将使用模块sys中的工具来退出游戏。

为开发游戏《外星人入侵》，我们创建了一个表示它的类，名为AlienInvasion。在这个类的方法__init__()中，调用函数pygame.init()来初始化背景设置，让Pygame能够正确地工作。然后调用pygame.display.set_mode()来创建一个显示窗口，游戏的所有图形元素都将在其中绘制。实参(1200, 800)是一个元组，指定了游戏窗口的尺寸——宽1200像素、高800像素（你可以根据自己的显示器尺寸调整这些值）。将这个显示窗口赋给属性self.screen，让这个类中的所有方法都能够使用它。

赋给属性self.screen的对象是一个surface。在Pygame中，surface是屏幕的一部分，用于显示游戏元素。在这个游戏中，每个元素（如外星人或飞船）都是一个surface。display.set_mode()返回的surface表示整个游戏窗口。激活游戏的动画循环后，每经过一次循环都将自动重绘这个surface，将用户输入触发的所有变化都反映出来。

这个游戏由方法run_game()控制。该方法包含一个不断运行的while循环，而这个循环包含一个事件循环以及管理屏幕更新的代码。事件是用户玩游戏时执行的操作，如按键或移动鼠标。为程序响应事件，可编写一个事件循环，以侦听事件并根据发生的事件类型执行合适的任务。run_game()控制的for循环就是一个事件循环。

为访问Pygame检测到的事件，我们使用了函数pygame.event.get()。这个函数返回一个列表，其中包含它在上一次被调用后发生的所有事件。所有键盘和鼠标事件都将导致这个for循环运行。在这个循环中，我们将编写一系列if语句来检测并响应特定的事件。例如，当玩家单击游戏窗口的关闭按钮时，将检测到pygame.QUIT事件，进而调用sys.exit()来退出游戏。

调用pygame.display.flip()，命令Pygame让最近绘制的屏幕可见。在这里，它在每次执行while循环时都绘制一个空屏幕，并擦去旧屏幕，使得只有新屏幕可见。我们移动游戏元素时，pygame.display.flip()将不断更新屏幕，以显示元素的新位置，并且在原来的位置隐藏元素，从而营造平滑移动的效果。

在这个文件末尾，创建一个游戏实例并调用run_game()。这些代码放在一个if代码块中，仅当直接运行该文件时，它们才会执行。如果此时运行alien_invasion.py，将看到一个空的Pygame窗口。
#### 设置背景色
Pygame默认创建一个黑色屏幕，这太乏味了。下面来将背景设置为另一种颜色，这是在方法__init__()末尾进行的。

在Pygame中，颜色是以RGB值指定的。这种颜色由红色、绿色和蓝色值组成，其中每个值的可能取值范围都是0～255。颜色值(255, 0, 0)表示红色，(0, 255, 0)表示绿色，而(0, 0, 255)表示蓝色。通过组合不同的RGB值，可创建1600万种颜色。在颜色值(230, 230, 230)中，红色、绿色和蓝色的量相同，它生成一种浅灰色。我们将这种颜色赋给了self.bg_color。

调用方法fill()用这种背景色填充屏幕。方法fill()用于处理surface，只接受一个实参：一种颜色。

#### 创建设置类
每次给游戏添加新功能时，通常也将引入一些新设置。下面来编写一个名为settings的模块，在其中包含一个名为Settings的类，用于将所有设置都存储在一个地方，以免在代码中到处添加设置。这样，每当需要访问设置时，只需使用一个设置对象。另外，在项目增大时，这使得修改游戏的外观和行为更容易：要修改游戏，只需修改（接下来将创建的）settings.py中的一些值，而无须查找散布在项目中的各种设置。

### 加载飞船图像
下面将飞船加入游戏中。为了在屏幕上绘制玩家的飞船，我们将加载一幅图像，再使用Pygame方法blit()绘制它。

为游戏选择素材时，务必要注意许可。最安全、最不费钱的方式是使用Pixabay等网站提供的免费图形，无须授权许可即可使用并修改。

在游戏中几乎可以使用任何类型的图像文件，但使用位图（.bmp）文件最为简单，因为Pygame默认加载位图。虽然可配置Pygame以使用其他文件类型，但有些文件类型要求你在计算机上安装相应的图像库。大多数图像为.jpg、.png或.gif格式，但可使用Photoshop、GIMP和Paint等工具将其转换为位图。

选择图像时，要特别注意背景色。请尽可能选择背景为透明或纯色的图像，便于使用图像编辑器将其背景替换为任意颜色。图像的背景色与游戏的背景色匹配时，游戏看起来最漂亮。你也可以将游戏的背景色设置成图像的背景色。

#### 创建Ship类
选择用于表示飞船的图像后，需要将其显示到屏幕上。我们创建一个名为ship的模块，其中包含Ship类，负责管理飞船的大部分行为。

#### 在屏幕上绘制飞船
下面更新alien_invasion.py，创建一艘飞船并调用其方法blitme()

### 重构：方法 `_check_events()` 和 `_update_screen()`
在大型项目中，经常需要在添加新代码前重构既有代码。重构旨在简化既有代码的结构，使其更容易扩展。本节将把越来越长的方法run_game()拆分成两个辅助方法（helper method）。辅助方法在类中执行任务，但并非是通过实例调用的。在Python中，辅助方法的名称以单个下划线打头。

#### 方法_check_events()
我们将把管理事件的代码移到一个名为_check_events()的方法中，以简化run_game()并隔离事件管理循环。通过隔离事件循环，可将事件管理与游戏的其他方面（如更新屏幕）分离。

#### 方法_update_screen()
为进一步简化run_game()，将更新屏幕的代码移到一个名为_update_screen()的方法中。

### 驾驶飞船
下面来让玩家能够左右移动飞船。我们将编写代码，在用户按左或右箭头键时做出响应。我们将首先专注于向右移动，再使用同样的原理来控制向左移动。通过这样做，你将学会如何控制屏幕图像的移动。

#### 响应按键
每当用户按键时，都将在Pygame中注册一个事件。事件都是通过方法pygame.event.get()获取的，因此需要在方法_check_events()中指定要检查哪些类型的事件。每次按键都被注册为一个KEYDOWN事件。

Pygame检测到KEYDOWN事件时，需要检查按下的是否是触发行动的键。例如，如果玩家按下的是右箭头键，就增大飞船的rect.centerx值，将飞船向右移动：

#### 允许持续移动
玩家按住右箭头键不放时，我们希望飞船不断向右移动，直到玩家松开为止。我们将让游戏检测pygame.KEYUP事件，以便知道玩家何时松开右箭头键。然后，结合使用KEYDOWN和KEYUP事件以及一个名为moving_right的标志来实现持续移动。

当标志moving_right为False时，飞船不会移动。玩家按下右箭头键时，我们将该标志设置为True，在玩家松开时将该标志重新设置为False。

飞船的属性都由Ship类控制，因此要给这个类添加一个名为moving_right的属性和一个名为update()的方法。方法update()检查标志moving_right的状态。如果该标志为True，就调整飞船的位置。我们将在while循环中调用这个方法，以调整飞船的位置。

#### 左右移动飞船
现在飞船能够持续向右移动了，添加向左移动的逻辑也很容易。我们将再次修改Ship类和方法_check_events()。

#### 调整飞船的速度
当前，每次执行while循环时，飞船最多移动1像素，但可在Settings类中添加属性ship_speed，用于控制飞船的速度。我们将根据这个属性决定飞船在每次循环时最多移动多远。

#### 限制飞船的移动范围
当前，如果玩家按住箭头键的时间足够长，飞船将飞到屏幕之外，消失得无影无踪。下面来修复这种问题，让飞船到达屏幕边缘后停止移动。

#### 重构_check_events()
随着游戏的开发，方法_check_events()将越来越长。因此将其部分代码放在两个方法中，其中一个处理KEYDOWN事件，另一个处理KEYUP事件

#### 按Q键退出
能够高效地响应按键后，我们来添加另一种退出游戏的方式。当前，每次测试新功能时，都需要单击游戏窗口顶部的X按钮来结束游戏，实在是太麻烦了。因此，我们来添加一个结束游戏的键盘快捷键—— Q键

#### 在全屏模式下运行游戏
Pygame支持全屏模式，你可能会更喜欢在这种模式下而非常规窗口中运行游戏。有些游戏在全屏模式下看起来更舒服，而在macOS系统中用全屏模式运行会提升性能。

### 射击
下面来添加射击功能。我们将编写在玩家按空格键时发射子弹（用小矩形表示）的代码。子弹将在屏幕中向上飞行，抵达屏幕上边缘后消失。

#### 添加子弹设置
首先，更新settings.py，在方法__init__()末尾存储新类Bullet所需的值：

#### 创建Bullet类
下面来创建存储Bullet类的文件bullet.py。Bullet类将负责管理子弹的行为。

#### 将子弹存储到编组中
定义Bullet类和必要的设置后，便可编写代码在玩家每次按空格键时都射出一发子弹了。我们将在AlienInvasion中创建一个编组（group），用于存储所有有效的子弹，以便管理发射出去的所有子弹。这个编组是pygame.sprite.Group类的一个实例。pygame.sprite.Group类似于列表，但提供了有助于开发游戏的额外功能。在主循环中，将使用这个编组在屏幕上绘制子弹以及更新每颗子弹的位置。

#### 开火
在AlienInvasion中，需要修改_check_keydown_events()，以便在玩家按空格键时发射一颗子弹。无须修改_check_keyup_events()，因为玩家松开空格键时什么都不会发生。还需要修改_update_screen()，确保在调用flip()前在屏幕上重绘每颗子弹。

为发射子弹，需要做的工作不少，因此编写一个新方法_fire_bullet()来完成这项任务
